import telebot
from telebot import types
import smtplib
from email.mime.text import MIMEText
import time

# ØªÙˆÙƒÙ† Ø§Ù„Ø¨ÙˆØª
TOKEN = '8302324300:AAEo6-_hRR1ljQ-mJ19KT-5R2AGjItAzJB4'
bot = telebot.TeleBot(TOKEN)

# Ø§Ù„Ù…Ø§Ù„Ùƒ
OWNER_ID = 6007494337
OWNER_USERNAME = "@adamkairim"

# Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†
user_data = {}
authorized_users = {OWNER_ID}

# Ø²Ø± Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©
@bot.message_handler(commands=['start'])
def start(message):
    if message.from_user.id not in authorized_users:
        bot.send_message(message.chat.id, f"âŒ Ù„Ø§ ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ø³ØªØ®Ø¯Ø§Ù… Ù‡Ø°Ø§ Ø§Ù„Ø¨ÙˆØª.\nØ§Ø·Ù„Ø¨ Ù…Ù† Ø§Ù„Ù…Ø§Ù„Ùƒ ØµÙ„Ø§Ø­ÙŠØ© Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…: {OWNER_USERNAME}")
        return

    markup = types.ReplyKeyboardMarkup(resize_keyboard=True)
    markup.add("ğŸ“§ Ø¥Ø¶Ø§ÙØ© Ø­Ø³Ø§Ø¨ Ø¥ÙŠÙ…ÙŠÙ„", "ğŸš€ Ø¨Ø¯Ø¦ Ø§Ù„Ø´Ø¯")
    bot.send_message(message.chat.id, "Ø§Ø®ØªØ± Ø®ÙŠØ§Ø±:", reply_markup=markup)

# Ø£Ù…Ø± Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©
@bot.message_handler(commands=['admin'])
def admin_add_user(message):
    if message.from_user.id != OWNER_ID:
        return
    bot.send_message(message.chat.id, "Ø£Ø±Ø³Ù„ Ù…Ø¹Ø±Ù Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø¬Ø¯ÙŠØ¯:")
    bot.register_next_step_handler(message, add_user)

def add_user(message):
    try:
        user_id = int(message.text)
        authorized_users.add(user_id)
        bot.send_message(message.chat.id, f"âœ… ØªÙ… Ø¥Ø¶Ø§ÙØ© {user_id} Ø¨Ù†Ø¬Ø§Ø­.")
    except:
        bot.send_message(message.chat.id, "âŒ Ø§Ù„Ù…Ø¹Ø±Ù ØºÙŠØ± ØµØ§Ù„Ø­.")

# Ø²Ø± Ø¥Ø¶Ø§ÙØ© Ø­Ø³Ø§Ø¨
@bot.message_handler(func=lambda m: m.text == "ğŸ“§ Ø¥Ø¶Ø§ÙØ© Ø­Ø³Ø§Ø¨ Ø¥ÙŠÙ…ÙŠÙ„")
def get_email(message):
    if message.from_user.id not in authorized_users:
        return
    bot.send_message(message.chat.id, "Ø£Ø±Ø³Ù„ Ø§Ù„Ø¥ÙŠÙ…ÙŠÙ„:")
    bot.register_next_step_handler(message, get_app_password)

def get_app_password(message):
    email = message.text
    user_data[message.from_user.id] = {'email': email}
    bot.send_message(message.chat.id, "Ø£Ø±Ø³Ù„ ÙƒÙ„Ù…Ø© Ù…Ø±ÙˆØ± Ø§Ù„ØªØ·Ø¨ÙŠÙ‚Ø§Øª:")
    bot.register_next_step_handler(message, save_password)

def save_password(message):
    password = message.text
    user_data[message.from_user.id]['password'] = password
    bot.send_message(message.chat.id, "âœ… ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø­Ø³Ø§Ø¨ Ø¨Ù†Ø¬Ø§Ø­.")

# Ø²Ø± Ø¨Ø¯Ø¡ Ø§Ù„Ø´Ø¯
@bot.message_handler(func=lambda m: m.text == "ğŸš€ Ø¨Ø¯Ø¦ Ø§Ù„Ø´Ø¯")
def start_spam(message):
    if message.from_user.id not in authorized_users:
        return

    if message.from_user.id not in user_data:
        bot.send_message(message.chat.id, "âŒ Ø£Ø¶Ù Ø­Ø³Ø§Ø¨ Ø¥ÙŠÙ…ÙŠÙ„ Ø£ÙˆÙ„Ø§Ù‹.")
        return

    bot.send_message(message.chat.id, "ğŸ“ Ø£Ø±Ø³Ù„ Ù…ÙˆØ¶ÙˆØ¹ Ø§Ù„Ø±Ø³Ø§Ù„Ø©:")
    bot.register_next_step_handler(message, get_subject)

def get_subject(message):
    user_data[message.from_user.id]['subject'] = message.text
    bot.send_message(message.chat.id, "âœ‰ï¸ Ø£Ø±Ø³Ù„ Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø±Ø³Ø§Ù„Ø©:")
    bot.register_next_step_handler(message, get_body)

def get_body(message):
    user_data[message.from_user.id]['body'] = message.text
    bot.send_message(message.chat.id, "ğŸ“® Ø£Ø±Ø³Ù„ Ø§Ù„Ø¥ÙŠÙ…ÙŠÙ„Ø§Øª Ø§Ù„Ù…Ø³ØªÙ„Ù…Ø© (ÙƒÙ„ Ø¥ÙŠÙ…ÙŠÙ„ ÙÙŠ Ø³Ø·Ø±):")
    bot.register_next_step_handler(message, get_receivers)

def get_receivers(message):
    receivers = message.text.strip().split('\n')
    user_data[message.from_user.id]['receivers'] = receivers
    bot.send_message(message.chat.id, "ğŸ” ÙƒÙ… Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ø±Ø§ØªØŸ")
    bot.register_next_step_handler(message, get_count)

def get_count(message):
    try:
        count = int(message.text)
        user_data[message.from_user.id]['count'] = count
        bot.send_message(message.chat.id, "â±ï¸ ÙƒÙ… Ø«Ø§Ù†ÙŠØ© Ø¨ÙŠÙ† ÙƒÙ„ Ø±Ø³Ø§Ù„Ø©ØŸ")
        bot.register_next_step_handler(message, get_delay)
    except:
        bot.send_message(message.chat.id, "âŒ Ø£Ø¯Ø®Ù„ Ø¹Ø¯Ø¯ ØµØ­ÙŠØ­.")
        bot.register_next_step_handler(message, get_count)

def get_delay(message):
    try:
        delay = float(message.text)
        user_data[message.from_user.id]['delay'] = delay
        bot.send_message(message.chat.id, "ğŸš€ Ø¨Ø¯Ø£ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„...")
        send_emails(message)
    except:
        bot.send_message(message.chat.id, "âŒ Ø£Ø¯Ø®Ù„ Ø±Ù‚Ù… ØµØ­ÙŠØ­.")
        bot.register_next_step_handler(message, get_delay)

def send_emails(message):
    data = user_data[message.from_user.id]
    email = data['email']
    password = data['password']
    subject = data['subject']
    body = data['body']
    receivers = data['receivers']
    count = data['count']
    delay = data['delay']

    success = 0
    fail = 0

    try:
        server = smtplib.SMTP('smtp.gmail.com', 587)
        server.starttls()
        server.login(email, password)
    except:
        bot.send_message(message.chat.id, "âŒ ÙØ´Ù„ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„. Ø±Ø¨Ù…Ø§ ØªÙ… Ø­Ø¸Ø± Ø§Ù„Ø­Ø³Ø§Ø¨.")
        return

    for i in range(count):
        for to_email in receivers:
            try:
                msg = MIMEText(body)
                msg['Subject'] = subject
                msg['From'] = email
                msg['To'] = to_email
                server.sendmail(email, to_email, msg.as_string())
                success += 1
            except:
                fail += 1

        bot.send_message(message.chat.id, f"ğŸ“¨ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„ Ø±Ù‚Ù… {i+1}/{count} âœ…:{success} âŒ:{fail}")
        time.sleep(delay)

    server.quit()
    bot.send_message(message.chat.id, f"âœ… ØªÙ… Ø§Ù„Ø§Ù†ØªÙ‡Ø§Ø¡ Ù…Ù† Ø§Ù„Ø¥Ø±Ø³Ø§Ù„.\nâœ… Ù†Ø§Ø¬Ø­Ø©: {success} âŒ ÙØ§Ø´Ù„Ø©: {fail}")

# ØªØ´ØºÙŠÙ„ Ø§Ù„Ø¨ÙˆØª
print("ğŸ¤– Bot is running...")
bot.infinity_polling()
